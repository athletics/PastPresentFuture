/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/statemanager
 * @version 0.0.1
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],function(n){return e(t,n)}):"object"==typeof exports?module.exports=e(t,require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t,t.jQuery))}(window,function(t){"use strict";function e(t){var e=!0;return e?t:(-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t)}function n(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));document.title=t}function r(){return t.history&&t.history.pushState&&t.history.replaceState?"dynamic":"traditional"}var a,i=!0;return a=function(){return i&&"object"==typeof console&&console.log?Function.prototype.bind.call(console.log,console):void 0}(),{debug:a,fullyQualifyUrl:e,setDocumentTitle:n,getMode:r}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(window,function(t,e){function n(e){o=t.extend({content:".page_content_holder",prefetchCacheLimit:15,ajaxCacheLimit:15},e)}function r(t,e){o[t]=e}function a(t){return t=t||!1,t?t in o?o[t]:null:o}var i=!0,o=(i?e.debug:function(){},{});return{init:n,set:r,get:a}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/State",["jquery","./Util"],function(n,r){return e(t,n,r)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e,n){"use strict";function r(){u.on("StateManager.AfterInitState",a),u.on("StateManager.PushState",i)}function a(){var n=t.history.state,r=0;null!==n&&"undefined"!=typeof n.scrollTarget&&e(n.scrollTarget).length>0&&(r=e(n.scrollTarget).first().offset().top),e("html").hasClass("initial-load")?e("html").removeClass("initial-load"):e("html, body").stop().animate({scrollTop:r},200),u.trigger("WindowEvents.Scroll")}function i(r,a){a=e.extend({options:{url:a.url},title:""},a),"traditional"===n.getMode()?t.location=a.url:(t.history.pushState(a.options,a.title,a.url),u.trigger("StateManager.NewState"))}var o=!0,u=(o?n.debug:function(){},e(t));return{init:r,pushState:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],function(n,r){return e(t,n,r)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e,n){function r(){l.on("StateManager.LoadingReveal",i).on("StateManager.LoadingComplete",o).on("StateManager.LoadingProgress",a)}function a(t,e){var n=0,r=e.event.target.getResponseHeader("X-Content-Length");"undefined"!=typeof r&&0!==r&&(n=e.event.loaded/r)}function i(){f.addClass("is-loading-ajax")}function o(){f.removeClass("is-loading-ajax"),s.css({overflow:"auto"})}var u=!0,l=(u?n.debug:function(){},e(t)),f=e("html"),s=e("body");return{init:r}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config","./State"],function(n,r,a,i){return e(t,n,r,a,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.State))}(window,function(t,e,n,r){"use strict";function a(n){if("undefined"==typeof n)return!1;if("undefined"==typeof n.url)return S(p+": loadAjax: ERROR: No url defined."),!1;m=n;var r=t.ProgressEvent&&t.FormData?!0:!1,a="undefined"!=typeof n.trackProgress?n.trackProgress:!1;M.url=n.url,r&&a&&(M.xhr=u),M.type="undefined"!=typeof n.type?n.type:"get",M.data="undefined"!=typeof n.data?n.data:{},"undefined"!=typeof n.dataType&&(M.dataType=n.dataType),M.timeout="undefined"!=typeof n.timeout?n.timeout:2e4,M.error=l,M.disableAfterSuccess="undefined"!=typeof n.disableAfterSuccess?n.disableAfterSuccess:!1,M.success=f,M.beforeSend=function(t){t.requestUrl=M.url},e.ajax(M)}function i(t){j.trigger("StateManager.LoadingProgress",{event:t,type:"upload"})}function o(t){t.loaded>h&&(h=t.loaded),j.trigger("StateManager.LoadingProgress",{event:t,type:"download"})}function u(){var e=new t.XMLHttpRequest;return e.upload.addEventListener("progress",i,!1),e.addEventListener("progress",o,!1),e}function l(t,e,n){S(p+": error loading: "+M.url),S(p+": error textStatus: "+e),S(p+": error errorThrown: "+n),"undefined"!=typeof m.error&&m.error(t,e,n)}function f(t,e,n){t.length<h&&(h=t.length),"undefined"!=typeof m.success&&m.success(t,e,n)}function s(t){var n,a=r.get("content");return t=e.parseHTML(t,document,!0),n=e(t),n.filter(a).add(n.find(a))}function d(t){var n,r;return t=e.parseHTML(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],document,!0),n=e(t),r=n.filter("title"),r.last().text()}function c(t){var n=e.grep(t.find("a"),function(t){var n=e(t).attr("href")||"";return-1!==n.indexOf("mailto:")?!1:!0});return n}function g(t){var r=t,a=c(r);return e.each(a,function(){var t=e(this);t.on("click."+p,function(t){t.preventDefault();var r=e(this),a=n.fullyQualifyUrl(r.attr("href")),i=null,o={};return 2===t.which||t.metaKey?!0:("undefined"!=typeof r.data("scroll-target")&&(i=r.data("scroll-target")),o={url:a,options:{scrollTarget:i,scrollPos:parseInt(e(document).scrollTop(),10),url:a}},void j.trigger("StateManager.GotoUrl",a,o))}),t.addClass("ajax-initialized")}),r}var p="Ajax",y=!0,S=y?n.debug:function(){},h=0,M={},j=e(t),m=null;return{loadAjax:a,parseHtml:s,parseTitle:d,ajaxifyLinks:g}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],function(n,r,a,i){return e(t,n,r,a,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.Ajax))}(window,function(t,e,n,r,a){"use strict";function i(){v||(b.limit=r.get("prefetchCacheLimit"),w.limit=r.get("ajaxCacheLimit"),j=e(r.get("content")).first(),j.length<1||(o(),u({isInitLoad:!0}),h(),v=!0))}function o(){q=t.history,L=n.getMode(),"traditional"!==L&&(a.ajaxifyLinks(C),U.on("popstate",function(){d(M(),{popstate:!0}),U.trigger("StateManager.StateChange")}))}function u(t){var e=!1,r="title"in t?t.title:document.title;"undefined"!=typeof t&&"undefined"!=typeof t.isInitLoad&&(e=t.isInitLoad),n.setDocumentTitle(r),e||U.trigger("EventTrackAjax.RecordPageview",{url:M(),title:r}),l(),U.trigger("StateManager.AfterInitState")}function l(){return"dynamic"!==L?!1:void e("a[data-prefetch]").each(function(t){var r=n.fullyQualifyUrl(e(this).attr("href"));r!==M()&&setTimeout(function(){g(r)},50*(t+1))})}function f(t){j.html(t.data),a.ajaxifyLinks(j),C.removeClass().addClass(t.classes),u(t)}function s(t){U.trigger(t?"StateManager.LoadingReveal":"StateManager.LoadingComplete")}function d(n,r){r=r||{},r=e.extend({url:n,popstate:!1},r),e(t).off("StateManager.FetchedData").on("StateManager.FetchedData",function(t,a){a.url===n&&(r.popstate||U.trigger("StateManager.PushState",r),s(!1),f(a),e(this).off("StateManager.FetchedData"))});var a=c({url:n,afterAjaxLoad:function(n,r,a){n=y(w,a.requestUrl,n),e(t).trigger("StateManager.FetchedData",n)}});"undefined"!=typeof a.loading&&a.loading&&s(!0)}function c(n){var r,i=n.url,o=!0;return(r=p(w.list,n.url))?e(t).trigger("StateManager.FetchedData",r):(r=p(b.list,n.url))?e(t).trigger("StateManager.FetchedData",r):(r=p(A,n.url))?{loading:!0}:(n.isPrefetch&&(o=!1),A.push({url:i}),a.loadAjax({url:i,dataType:"html",trackProgress:o,success:n.afterAjaxLoad,error:function(){}}),{loading:!0})}function g(n){"traditional"!==L&&c({url:n,isPrefetch:!0,afterAjaxLoad:function(r){S(n),r=y(b,n,r),e(t).trigger("StateManager.FetchedData",r)}})}function p(t,e){if(t.length>0)for(var n=0;n<t.length;n++)if(t[n].url===e)return t[n];return!1}function y(t,n,r){var i={url:n,title:a.parseTitle(r),data:a.parseHtml(r),classes:r.match(/body\sclass=['|"]([^'|"]*)['|"]/)[1]};return t.list.push(i),t.list.length>t.limit&&(x("over cache limit of "+t.limit+", removing oldest data"),t.list=e.grep(t.list,function(t,e){return 0!==e})),i}function S(t){A=e.grep(A,function(e){return e.url!==t})}function h(){U.on("StateManager.GotoUrl",function(t,e,n){d(e,n)})}function M(){var e=t.history;return null!==e.state?e.state.url:t.location.href}var j,m=!0,x=m?n.debug:function(){},v=!1,q=null,L="traditional",U=e(t),C=e("body"),b={list:[],limit:null},w={list:[],limit:null},A=[];return{init:i}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.Config,n.State,n.Loading,n.Ajax,n.Manager)}}(window,function(t,e,n,r,a,i){"use strict";function o(t){t=t||!1,e.init(t),n.init(),r.init(),i.init()}return o.prototype.Util=t,o.prototype.Config=e,o.prototype.State=n,o.prototype.Loading=r,o.prototype.Ajax=a,o.prototype.Manager=i,o});