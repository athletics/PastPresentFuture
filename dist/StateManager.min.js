/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/statemanager
 * @version 0.0.1
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Util",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t.jQuery))}(this,function(){"use strict";function t(){n()}function e(t){return-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t}function n(){Array.prototype.remove=function(t,e){var n=this.slice((e||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,n)}}function r(t){document.title=i(t)}function i(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));return t}function a(){return!window.history&&window.history.pushState&&window.history.replaceState?"traditional":"dynamic"}var o,u=!0;return o=function(){return u&&"object"==typeof console&&console.log?Function.prototype.bind.call(console.log,console):void 0}(),{init:t,debug:o,fullyQualifyUrl:e,setDocumentTitle:r,getMode:a}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/State",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){"use strict";function n(){o.on("StateManager.AfterInitState",r)}function r(){var e=window.history.state,n=0;"undefined"!=typeof e.scrollTarget&&t(e.scrollTarget).length>0&&(n=t(e.scrollTarget).first().offset().top),t("html").hasClass("initial-load")?t("html").removeClass("initial-load"):t("html, body").stop().animate({scrollTop:n},200),o.trigger("OnDemandImages.Init"),o.trigger("WindowEvents.Scroll")}function i(t,n,r){"traditional"===e.getMode()?window.location=n:window.history.pushState(r,t,n)}var a=!0,o=(a?e.debug:function(){},t(window));return{init:n,pushState:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Loading",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(){l.on(o+".Reveal",i).on(o+".Complete",a).on(o+".Progress",r)}function r(t,e){var n=0,r=e.event.target.getResponseHeader("X-Content-Length");"undefined"!=typeof r&&0!==r&&(n=e.event.loaded/r)}function i(){d.addClass("is-loading-ajax")}function a(){d.removeClass("is-loading-ajax"),s.css({overflow:"auto"})}var o="Loading",u=!0,l=(u?e.debug:function(){},t(window)),d=t("html"),s=t("body");return{init:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Ajax",["jquery","./Util","./State"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t.jQuery,t.StateManager.Util,t.StateManager.State))}(this,function(t,e,n){"use strict";function r(e){if("undefined"==typeof e)return!1;if("undefined"==typeof e.url)return y(g+": loadAjax: ERROR: No url defined."),!1;S=e;var n=window.ProgressEvent&&window.FormData?!0:!1,r="undefined"!=typeof e.trackProgress?e.trackProgress:!1;v.url=e.url,n&&r&&(v.xhr=o),v.type="undefined"!=typeof e.type?e.type:"get",v.data="undefined"!=typeof e.data?e.data:{},"undefined"!=typeof e.dataType&&(v.dataType=e.dataType),v.timeout="undefined"!=typeof e.timeout?e.timeout:2e4,v.error=u,v.disableAfterSuccess="undefined"!=typeof e.disableAfterSuccess?e.disableAfterSuccess:!1,v.success=l,t.ajax(v)}function i(t){x.trigger("Loading.Progress",{event:t,type:"upload"})}function a(t){t.loaded>h&&(h=t.loaded),x.trigger("Loading.Progress",{event:t,type:"download"})}function o(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",i,!1),t.addEventListener("progress",a,!1),t}function u(t,e,n){y(g+": error loading: "+v.url),y(g+": error textStatus: "+e),y(g+": error errorThrown: "+n),"undefined"!=typeof S.error&&S.error(t,e,n)}function l(t){t.length<h&&(h=t.length),"undefined"!=typeof S.success&&S.success(t)}function d(t){return t=s(t,"page_content")}function s(t,e){var n="<!-- start:"+e+" -->",r="<!-- end:"+e+" -->",i="<!-- start:"+e,a="end:"+e+" -->",o=t.indexOf(n),u=t.indexOf(r),l="";return(-1===o||-1===u)&&(n=i,r=a,o=t.indexOf(n),u=t.indexOf(r)),-1==o||-1==u?"":l=t.substring(o+n.length,u)}function f(e){var n=t.grep(e.find("a"),function(e){var n=t(e).attr("href")||"";return-1!==n.indexOf("mailto:")?!1:-1!==n.indexOf("localhost")?!0:-1!==n.indexOf(":")?!1:!0});return n}function c(r){var i=r,a=f(i);return t.each(a,function(){var r=t(this);r.on("click."+g,function(r){r.preventDefault();var i=t(this),a=e.fullyQualifyUrl(i.attr("href")),o=null,u=null;return 2==r.which||r.metaKey?!0:("undefined"!=typeof i.attr("title")&&(o=i.attr("title")),"undefined"!=typeof i.data("scroll-target")&&(u=i.data("scroll-target")),n.pushState(o,a,{scrollTarget:u,scrollPos:parseInt(t(document).scrollTop(),10),url:a}),x.trigger("StateManager.gotoUrl",a),void i.addClass("ajax-initialized"))}),r.addClass("ajax-initialized")}),i}var g="Ajax",p=!0,y=p?e.debug:function(){},h=0,v={},x=t(window),S=null;return{loadAjax:r,parseHtml:d,parseAjaxContent:s,ajaxifyLinks:c}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Manager",["jquery","./Util","./Ajax"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t.jQuery,t.StateManager.Util,t.StateManager.Ajax))}(this,function(t,e,n){"use strict";function r(){S||(h=t(".page_content_holder").first(),h.length<1||(i(),a({isInitLoad:!0}),y(),S=!0))}function i(){m=window.history,j=e.getMode(),"traditional"!==j&&(n.ajaxifyLinks(w),M.on("popstate",function(){d(m.state.url,{}),M.trigger("StateManager.StateChange")}))}function a(n){var r=!1,i=m.state,a=t("div.content").data("config"),u="";"undefined"!=typeof n&&"undefined"!=typeof n.isInitLoad&&(r=n.isInitLoad),"undefined"!=typeof a&&null!==a&&("undefined"!=typeof a.title&&(u=a.title),"undefined"!=typeof a.bodyClass&&w.addClass(a.bodyClass),e.setDocumentTitle(u),r||M.trigger("EventTrackAjax.RecordPageview",{url:i.url,title:u}),q=a,o(),M.trigger("StateManager.AfterInitState"))}function o(){if("dynamic"!==j)return!1;var n=m.state;t("a[data-prefetch]").each(function(r){if(r>b.limit)return!1;var i=e.fullyQualifyUrl(t(this).attr("href"));i!==n.url&&setTimeout(function(){f(i)},50*(r+1))})}function u(t){h.html(t.data),n.ajaxifyLinks(h),a()}function l(t){M.trigger(t?"Loading.Reveal":"Loading.Complete")}function d(t,e){"undefined"==typeof e&&(e={});var n=t,r=e,i=s({url:n,afterAjaxLoad:function(t){var e=L[L.length-1];p(n),g(A,n,t),e==n?d(n,r):x("******* still loading: "+e)}});return"undefined"!=typeof i.loading&&i.loading?(l(!0),!1):(l(!1),void u(i,e))}function s(t){var e,r=t.url,i=!0;return(e=c(A.list,t.url))?e:(e=c(b.list,t.url))?e:(e=c(L,t.url))?{loading:!0}:(t.isPrefetch&&(i=!1),L.push({url:r}),n.loadAjax({url:r,dataType:"html",trackProgress:i,success:t.afterAjaxLoad,error:function(){}}),{loading:!0})}function f(t){return"traditional"!==j?c(A.list,t)?!0:c(b.list,t)?!0:c(L,t)?!0:void s({url:t,isPrefetch:!0,afterAjaxLoad:function(e){p(t),g(b,t,e)}}):void 0}function c(t,e){if(t.length>0)for(var n=0;n<t.length;n++)if(t[n].url===e)return t[n];return!1}function g(e,r,i){var a={url:r,data:n.parseHtml(i)};e.list.push(a),e.list.length>e.limit&&(x("over cache limit of "+e.limit+", removing oldest data"),e.list=t.grep(e.list,function(t,e){return 0!==e}))}function p(e){L=t.grep(L,function(t){return t.url!==e})}function y(){M.on("StateManager.gotoUrl",function(t,e){d(e,{})})}var h,v=!0,x=v?e.debug:function(){},S=!1,m=null,j="traditional",M=t(window),w=t("body"),q={},b={list:[],limit:15},A={list:[],limit:15},L=[];return{init:r}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("src/Index",["./Util","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.State,n.Loading,n.Ajax,n.Manager)}}(this,function(t,e,n,r,i){"use strict";function a(){t.debug;t.init(),e.init(),n.init(),i.init()}return a.prototype.Util=t,a.prototype.State=e,a.prototype.Loading=n,a.prototype.Ajax=r,a.prototype.Manager=i,a});