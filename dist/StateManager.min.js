/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/StateManager
 * @version 0.1.0
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],function(a){return e(t,a)}):"object"==typeof exports?module.exports=e(t,require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t,t.jQuery))}(window,function(t,e){"use strict";function a(){var e=t.history;return null!==e.state?e.state.url:t.location.href}function n(t){var e=document.createElement("a");return e.href=t,e.href}function r(){return t.history&&t.history.pushState&&t.history.replaceState?"dynamic":"traditional"}function i(){var a=t.history.state||{};if(!1 in a)return 0;var n=e(a.scrollTarget);return n.length?n.first().offset().top:0}function o(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var a in e)e.hasOwnProperty(a)&&(t=t.replace(new RegExp(a,"g"),e[a]));document.title=t}return{currentStateUrl:a,getAbsoluteUrl:n,getMode:r,getScrollTarget:i,setDocumentTitle:o}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(window,function(t){function e(e){r=t.extend({content:".page_content_holder",ajaxContainer:".page_content_holder",prefetchCacheLimit:15,ajaxCacheLimit:15},e)}function a(t,e){r[t]=e}function n(t){return t=t||!1,t?t in r?r[t]:null:r}var r={};return{init:e,set:a,get:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/PushState",["jquery","./Util"],function(a,n){return e(t,a,n)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.PushState=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e,a){"use strict";function n(){l.on("StateManager:AfterInitState",r).on("StateManager:PushState",i)}function r(){var t=a.getScrollTarget();o.hasClass("initial-load")?o.removeClass("initial-load"):u.stop().animate({scrollTop:t},200)}function i(n,r){r=e.extend({options:{url:r.url},title:""},r),"traditional"===a.getMode()?t.location=r.url:(t.history.pushState(r.options,r.title,r.url),l.trigger("StateManager:NewState"))}var o=e("html"),u=e("html, body"),l=e(t);return{init:n,pushState:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],function(a,n){return e(t,a,n)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e){function a(){i.on("StateManager:LoadingReveal",n).on("StateManager:LoadingComplete",r)}function n(){o.addClass("is-loading-ajax")}function r(){o.removeClass("is-loading-ajax")}var i=e(t),o=e("html");return{init:a}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config"],function(a,n,r){return e(t,a,n,r)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config))}(window,function(t,e,a,n){"use strict";function r(t){if(t=t||{},!(!1 in t)){var a=e.extend({data:{},dataType:"html",disableAfterSuccess:!1,timeout:2e4,type:"get"},t);d=t,a.error=i,a.success=o,a.beforeSend=function(t){t.requestUrl=a.url},e.ajax(a)}}function i(t,e,a){!1 in d||d.error(t,e,a)}function o(t,e,a){t.length<c&&(c=t.length),!1 in d||d.success(t,e,a)}function u(t){t=e.parseHTML(t,document,!0);var a=n.get("content"),r=e(t);return r.filter(a).add(r.find(a))}function l(t){t=e.parseHTML(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],document,!0);var a=e(t),n=a.filter("title");return n.last().text()}function f(a){var n=e.grep(a.find("a"),function(a){var n=e(a),r=n.attr("href")||"";return"_blank"===n.attr("target")?!1:-1!==r.indexOf("mailto:")||-1!==r.indexOf("javascript:")?!1:-1!==r.indexOf("//")&&-1===r.indexOf(t.location.hostname)?!1:!0});return n}function s(t){var a=f(t);return e.each(a,function(){e(this).on("click.StateManager",function(t){if(2===t.which||t.metaKey)return!0;var a=e(this),n=a.attr("href");g.trigger("StateManager:GotoUrl",[n,{url:n,options:{scrollPos:parseInt(e(document).scrollTop(),10),scrollTarget:a.data("scroll-target"),url:n}}]),t.preventDefault()}).addClass("ajax-initialized")}),t}var c=0,g=e(t),d=null;return{loadAjax:r,parseHtml:u,parseTitle:l,ajaxifyLinks:s}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],function(a,n,r,i){return e(t,a,n,r,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.Ajax))}(window,function(t,e,a,n,r){"use strict";function i(){y||(v=a.getMode(),C.limit=n.get("prefetchCacheLimit"),L.limit=n.get("ajaxCacheLimit"),f(),m.length&&(o(),u({isInitLoad:!0}),j(),y=!0))}function o(){"traditional"!==v&&(r.ajaxifyLinks(U),q.on("popstate",function(t){null!==t.originalEvent.state&&(g(a.currentStateUrl(),{popstate:!0}),q.trigger("StateManager:PopState"))}))}function u(t){t=t||{},t=e.extend({isInitLoad:!1,title:document.title},t),t.isInitLoad||(a.setDocumentTitle(t.title),f(),q.trigger("StateManager:RecordPageview",{url:a.currentStateUrl(),title:t.title})),l(),q.trigger("StateManager:AfterInitState")}function l(){"traditional"!==v&&e("a[data-prefetch]").each(function(t){var n=e(this).attr("href");n!==a.currentStateUrl()&&setTimeout(function(){p(n)},50*(t+1))})}function f(){m=e(n.get("content")).first(),x=e(n.get("ajaxContainer")).first(),n.get("content")!==n.get("ajaxContainer")&&q.trigger("StateManager:BeforeTransition",{contentHolder:m,ajaxContainer:x})}function s(t,e){e.prevBodyClasses=U.attr("class"),e.pageConfig=e.data.attr("data-page-config"),x.html(e.data.html()),r.ajaxifyLinks(x),U.removeClass().addClass(e.classes),n.get("content")!==n.get("ajaxContainer")?q.trigger("StateManager:AnimateTransition",e):u(e)}function c(t){q.trigger(t?"StateManager:LoadingReveal":"StateManager:LoadingComplete")}function g(n,r){if(r=r||{},r=e.extend({url:n,popstate:!1},r),t.location.href===a.getAbsoluteUrl(n)&&!r.popstate)return void q.trigger("StateManager:ResetPage");q.off("StateManager:FetchedData").on("StateManager:FetchedData",function(t,a){a.url===n&&(r.popstate||q.trigger("StateManager:PushState",r),c(!1),q.trigger("StateManager:RenderUrl",a),e(this).off("StateManager:FetchedData"))});var i=d({url:n,afterAjaxLoad:function(t,e,a){t=h(L,a.requestUrl,t),q.trigger("StateManager:FetchedData",t)}});"loading"in i&&c(!0)}function d(t){var e=!0,a={};return(a=S(L.list,t.url))?q.trigger("StateManager:FetchedData",a):(a=S(C.list,t.url))?q.trigger("StateManager:FetchedData",a):(a=S(A,t.url))?{loading:!0}:(t.isPrefetch&&(e=!1),A.push({url:t.url}),r.loadAjax({url:t.url,dataType:"html",trackProgress:e,success:t.afterAjaxLoad,error:function(){location.reload(!0)}}),{loading:!0})}function p(t){"traditional"!==v&&d({url:t,isPrefetch:!0,afterAjaxLoad:function(e){M(t),e=h(C,t,e),q.trigger("StateManager:FetchedData",e)}})}function S(t,e){var a=!1;if(!t.length)return a;for(var n=0;n<t.length;n++)if(t[n].url===e){a=t[n];break}return a}function h(t,a,n){var i={url:a,title:r.parseTitle(n),data:r.parseHtml(n),classes:n.match(/body\sclass=['|"]([^'|"]*)['|"]/)[1]};return t.list.push(i),t.list.length>t.limit&&(t.list=e.grep(t.list,function(t,e){return 0!==e})),i}function M(t){A=e.grep(A,function(e){return e.url!==t})}function j(){q.on("StateManager:GotoUrl",function(t,e,a){g(e,a)}).on("StateManager:RenderUrl",s).on("StateManager:InitState",function(t,e){u(e)})}var m,x,y=!1,v=(t.history,"traditional"),q=e(t),U=e("body"),C={list:[],limit:null},L={list:[],limit:null},A=[];return{init:i}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./PushState","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./PushState"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var a=t.StateManager;t.StateManager=e(a.Util,a.Config,a.PushState,a.Loading,a.Ajax,a.Manager)}}(window,function(t,e,a,n,r,i){"use strict";function o(t){t=t||!1,e.init(t),a.init(),n.init(),i.init()}var u=o.prototype;return u.Util=t,u.Config=e,u.PushState=a,u.Loading=n,u.Ajax=r,u.Manager=i,o});