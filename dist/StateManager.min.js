/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/statemanager
 * @version 0.0.1
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t.jQuery))}(this,function(){"use strict";function t(t){var e=!0;return e?t:(-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t)}function e(t){document.title=n(t)}function n(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));return t}function r(){return!window.history&&window.history.pushState&&window.history.replaceState?"traditional":"dynamic"}var i,a=!0;return i=function(){return a&&"object"==typeof console&&console.log?Function.prototype.bind.call(console.log,console):void 0}(),{debug:i,fullyQualifyUrl:t,setDocumentTitle:e,getMode:r}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(e){o=t.extend({content:".page_content_holder"},e)}function r(t,e){o[t]=e}function i(t){return t=t||!1,t?t in o?o[t]:null:o}var a=!0,o=(a?e.debug:function(){},{});return{init:n,set:r,get:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/State",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){"use strict";function n(){o.on("StateManager.AfterInitState",r)}function r(){var e=window.history.state,n=0;null!==e&&"undefined"!=typeof e.scrollTarget&&t(e.scrollTarget).length>0&&(n=t(e.scrollTarget).first().offset().top),t("html").hasClass("initial-load")?t("html").removeClass("initial-load"):t("html, body").stop().animate({scrollTop:n},200),o.trigger("OnDemandImages.Init"),o.trigger("WindowEvents.Scroll")}function i(t,n,r){"traditional"===e.getMode()?window.location=n:window.history.pushState(r,t,n)}var a=!0,o=(a?e.debug:function(){},t(window));return{init:n,pushState:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(){f.on(o+".Reveal",i).on(o+".Complete",a).on(o+".Progress",r)}function r(t,e){var n=0,r=e.event.target.getResponseHeader("X-Content-Length");"undefined"!=typeof r&&0!==r&&(n=e.event.loaded/r)}function i(){l.addClass("is-loading-ajax")}function a(){l.removeClass("is-loading-ajax"),d.css({overflow:"auto"})}var o="Loading",u=!0,f=(u?e.debug:function(){},t(window)),l=t("html"),d=t("body");return{init:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config","./State"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Config"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.State))}(this,function(t,e,n,r){"use strict";function i(e){if("undefined"==typeof e)return!1;if("undefined"==typeof e.url)return y(g+": loadAjax: ERROR: No url defined."),!1;m=e;var n=window.ProgressEvent&&window.FormData?!0:!1,r="undefined"!=typeof e.trackProgress?e.trackProgress:!1;j.url=e.url,n&&r&&(j.xhr=u),j.type="undefined"!=typeof e.type?e.type:"get",j.data="undefined"!=typeof e.data?e.data:{},"undefined"!=typeof e.dataType&&(j.dataType=e.dataType),j.timeout="undefined"!=typeof e.timeout?e.timeout:2e4,j.error=f,j.disableAfterSuccess="undefined"!=typeof e.disableAfterSuccess?e.disableAfterSuccess:!1,j.success=l,t.ajax(j)}function a(t){S.trigger("Loading.Progress",{event:t,type:"upload"})}function o(t){t.loaded>h&&(h=t.loaded),S.trigger("Loading.Progress",{event:t,type:"download"})}function u(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",a,!1),t.addEventListener("progress",o,!1),t}function f(t,e,n){y(g+": error loading: "+j.url),y(g+": error textStatus: "+e),y(g+": error errorThrown: "+n),"undefined"!=typeof m.error&&m.error(t,e,n)}function l(t){t.length<h&&(h=t.length),"undefined"!=typeof m.success&&m.success(t)}function d(e){var r=n.get("content");return e=t.parseHTML(e,document,!0),e=t(e),e.filter(r).add(e.find(r))}function s(e){var n=t.grep(e.find("a"),function(e){var n=t(e).attr("href")||"";return-1!==n.indexOf("mailto:")?!1:!0});return n}function c(n){var i=n,a=s(i);return t.each(a,function(){var n=t(this);n.on("click."+g,function(n){n.preventDefault();var i=t(this),a=e.fullyQualifyUrl(i.attr("href")),o=null,u=null;return 2==n.which||n.metaKey?!0:("undefined"!=typeof i.attr("title")&&(o=i.attr("title")),"undefined"!=typeof i.data("scroll-target")&&(u=i.data("scroll-target")),r.pushState(o,a,{scrollTarget:u,scrollPos:parseInt(t(document).scrollTop(),10),url:a}),S.trigger("StateManager.gotoUrl",a),void i.addClass("ajax-initialized"))}),n.addClass("ajax-initialized")}),i}var g="Ajax",p=!0,y=p?e.debug:function(){},h=0,j={},S=t(window),m=null;return{loadAjax:i,parseHtml:d,ajaxifyLinks:c}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.Ajax))}(this,function(t,e,n,r){"use strict";function i(){v||(j=t(".page_content_holder").first(),j.length<1||(a(),o({isInitLoad:!0}),h(),v=!0))}function a(){x=window.history,M=e.getMode(),"traditional"!==M&&(r.ajaxifyLinks(q),w.on("popstate",function(){d(x.state.url,{}),w.trigger("StateManager.StateChange")}))}function o(r){var i=!1,a=x.state,o=t(n.get("content")).data("config"),f="";"undefined"!=typeof r&&"undefined"!=typeof r.isInitLoad&&(i=r.isInitLoad),"undefined"!=typeof o&&null!==o&&("undefined"!=typeof o.title&&(f=o.title),"undefined"!=typeof o.bodyClass&&q.addClass(o.bodyClass),e.setDocumentTitle(f),i||w.trigger("EventTrackAjax.RecordPageview",{url:a.url,title:f}),U=o,u(),w.trigger("StateManager.AfterInitState"))}function u(){if("dynamic"!==M)return!1;var n=x.state;t("a[data-prefetch]").each(function(r){if(r>b.limit)return!1;var i=e.fullyQualifyUrl(t(this).attr("href"));i!==n.url&&setTimeout(function(){c(i)},50*(r+1))})}function f(t){j.html(t.data),r.ajaxifyLinks(j),o()}function l(t){w.trigger(t?"Loading.Reveal":"Loading.Complete")}function d(t,e){"undefined"==typeof e&&(e={});var n=t,r=e,i=s({url:n,afterAjaxLoad:function(t){var e=L[L.length-1].url;y(n),p(C,n,t),e==n?d(n,r):m("******* still loading: "+e)}});return"undefined"!=typeof i.loading&&i.loading?(l(!0),!1):(l(!1),void f(i,e))}function s(t){var e,n=t.url,i=!0;return(e=g(C.list,t.url))?e:(e=g(b.list,t.url))?e:(e=g(L,t.url))?{loading:!0}:(t.isPrefetch&&(i=!1),L.push({url:n}),r.loadAjax({url:n,dataType:"html",trackProgress:i,success:t.afterAjaxLoad,error:function(){}}),{loading:!0})}function c(t){return"traditional"!==M?g(C.list,t)?!0:g(b.list,t)?!0:g(L,t)?!0:void s({url:t,isPrefetch:!0,afterAjaxLoad:function(e){y(t),p(b,t,e)}}):void 0}function g(t,e){if(t.length>0)for(var n=0;n<t.length;n++)if(t[n].url===e)return t[n];return!1}function p(e,n,i){var a={url:n,data:r.parseHtml(i)};e.list.push(a),e.list.length>e.limit&&(m("over cache limit of "+e.limit+", removing oldest data"),e.list=t.grep(e.list,function(t,e){return 0!==e}))}function y(e){L=t.grep(L,function(t){return t.url!==e})}function h(){w.on("StateManager.gotoUrl",function(t,e){d(e,{})})}var j,S=!0,m=S?e.debug:function(){},v=!1,x=null,M="traditional",w=t(window),q=t("body"),U={},b={list:[],limit:15},C={list:[],limit:15},L=[];return{init:i}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.Config,n.State,n.Loading,n.Ajax,n.Manager)}}(this,function(t,e,n,r,i,a){"use strict";function o(t){t=t||!1,e.init(t),n.init(),r.init(),a.init()}return o.prototype.Util=t,o.prototype.Config=e,o.prototype.State=n,o.prototype.Loading=r,o.prototype.Ajax=i,o.prototype.Manager=a,o});