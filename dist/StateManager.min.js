/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/statemanager
 * @version 0.0.1
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t.jQuery))}(this,function(){"use strict";function t(t){var e=!0;return e?t:(-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t)}function e(t){document.title=n(t)}function n(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));return t}function a(){return!window.history&&window.history.pushState&&window.history.replaceState?"traditional":"dynamic"}var r,i=!0;return r=function(){return i&&"object"==typeof console&&console.log?Function.prototype.bind.call(console.log,console):void 0}(),{debug:r,fullyQualifyUrl:t,setDocumentTitle:e,getMode:a}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(e){o=t.extend({content:".page_content_holder",prefetchCacheLimit:15,ajaxCacheLimit:15},e)}function a(t,e){o[t]=e}function r(t){return t=t||!1,t?t in o?o[t]:null:o}var i=!0,o=(i?e.debug:function(){},{});return{init:n,set:a,get:r}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/State",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){"use strict";function n(){o.on("StateManager.AfterInitState",a)}function a(){var e=window.history.state,n=0;null!==e&&"undefined"!=typeof e.scrollTarget&&t(e.scrollTarget).length>0&&(n=t(e.scrollTarget).first().offset().top),t("html").hasClass("initial-load")?t("html").removeClass("initial-load"):t("html, body").stop().animate({scrollTop:n},200),o.trigger("OnDemandImages.Init"),o.trigger("WindowEvents.Scroll")}function r(t,n,a){"traditional"===e.getMode()?window.location=n:(window.history.pushState(a,t,n),o.trigger("StateManager.NewState"))}var i=!0,o=(i?e.debug:function(){},t(window));return{init:n,pushState:r}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(){u.on("StateManager.LoadingReveal",r).on("StateManager.LoadingComplete",i).on("StateManager.LoadingProgress",a)}function a(t,e){var n=0,a=e.event.target.getResponseHeader("X-Content-Length");"undefined"!=typeof a&&0!==a&&(n=e.event.loaded/a)}function r(){f.addClass("is-loading-ajax")}function i(){f.removeClass("is-loading-ajax"),l.css({overflow:"auto"})}var o=!0,u=(o?e.debug:function(){},t(window)),f=t("html"),l=t("body");return{init:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config","./State"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Config"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.State))}(this,function(t,e,n,a){"use strict";function r(e){if("undefined"==typeof e)return!1;if("undefined"==typeof e.url)return y(g+": loadAjax: ERROR: No url defined."),!1;m=e;var n=window.ProgressEvent&&window.FormData?!0:!1,a="undefined"!=typeof e.trackProgress?e.trackProgress:!1;S.url=e.url,n&&a&&(S.xhr=u),S.type="undefined"!=typeof e.type?e.type:"get",S.data="undefined"!=typeof e.data?e.data:{},"undefined"!=typeof e.dataType&&(S.dataType=e.dataType),S.timeout="undefined"!=typeof e.timeout?e.timeout:2e4,S.error=f,S.disableAfterSuccess="undefined"!=typeof e.disableAfterSuccess?e.disableAfterSuccess:!1,S.success=l,t.ajax(S)}function i(t){j.trigger("StateManager.LoadingProgress",{event:t,type:"upload"})}function o(t){t.loaded>h&&(h=t.loaded),j.trigger("StateManager.LoadingProgress",{event:t,type:"download"})}function u(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",i,!1),t.addEventListener("progress",o,!1),t}function f(t,e,n){y(g+": error loading: "+S.url),y(g+": error textStatus: "+e),y(g+": error errorThrown: "+n),"undefined"!=typeof m.error&&m.error(t,e,n)}function l(t){t.length<h&&(h=t.length),"undefined"!=typeof m.success&&m.success(t)}function d(e){var a=n.get("content");return e=t.parseHTML(e,document,!0),e=t(e),e.filter(a).add(e.find(a))}function s(e){var n=t.grep(e.find("a"),function(e){var n=t(e).attr("href")||"";return-1!==n.indexOf("mailto:")?!1:!0});return n}function c(n){var r=n,i=s(r);return t.each(i,function(){var n=t(this);n.on("click."+g,function(n){n.preventDefault();var r=t(this),i=e.fullyQualifyUrl(r.attr("href")),o=null,u=null;return 2==n.which||n.metaKey?!0:("undefined"!=typeof r.attr("title")&&(o=r.attr("title")),"undefined"!=typeof r.data("scroll-target")&&(u=r.data("scroll-target")),a.pushState(o,i,{scrollTarget:u,scrollPos:parseInt(t(document).scrollTop(),10),url:i}),j.trigger("StateManager.GotoUrl",i),void r.addClass("ajax-initialized"))}),n.addClass("ajax-initialized")}),r}var g="Ajax",p=!0,y=p?e.debug:function(){},h=0,S={},j=t(window),m=null;return{loadAjax:r,parseHtml:d,ajaxifyLinks:c}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.Ajax))}(this,function(t,e,n,a){"use strict";function r(){M||(S=t(n.get("content")).first(),S.length<1||(i(),o({isInitLoad:!0}),h(),M=!0))}function i(){v=window.history,x=e.getMode(),"traditional"!==x&&(a.ajaxifyLinks(q),w.on("popstate",function(){d(v.state.url,{}),w.trigger("StateManager.StateChange")}))}function o(a){var r=!1,i=v.state,o=t(n.get("content")).data("config"),f="";"undefined"!=typeof a&&"undefined"!=typeof a.isInitLoad&&(r=a.isInitLoad),"undefined"!=typeof o&&null!==o&&("undefined"!=typeof o.title&&(f=o.title),"undefined"!=typeof o.bodyClass&&q.addClass(o.bodyClass),e.setDocumentTitle(f),r||w.trigger("EventTrackAjax.RecordPageview",{url:i.url,title:f}),L=o,u(),w.trigger("StateManager.AfterInitState"))}function u(){if("dynamic"!==x)return!1;var n=v.state;t("a[data-prefetch]").each(function(a){var r=e.fullyQualifyUrl(t(this).attr("href"));r!==n.url&&setTimeout(function(){c(r)},50*(a+1))})}function f(t){S.html(t.data),a.ajaxifyLinks(S),o()}function l(t){w.trigger(t?"StateManager.LoadingReveal":"StateManager.LoadingComplete")}function d(t,e){"undefined"==typeof e&&(e={});var n=t,a=e,r=s({url:n,afterAjaxLoad:function(t){var e=b[b.length-1].url;y(n),p(U,n,t),e==n?d(n,a):m("******* still loading: "+e)}});return"undefined"!=typeof r.loading&&r.loading?(l(!0),!1):(l(!1),void f(r,e))}function s(t){var e,n=t.url,r=!0;return(e=g(U.list,t.url))?e:(e=g(C.list,t.url))?e:(e=g(b,t.url))?{loading:!0}:(t.isPrefetch&&(r=!1),b.push({url:n}),a.loadAjax({url:n,dataType:"html",trackProgress:r,success:t.afterAjaxLoad,error:function(){}}),{loading:!0})}function c(t){"traditional"!==x&&s({url:t,isPrefetch:!0,afterAjaxLoad:function(e){y(t),p(C,t,e)}})}function g(t,e){if(t.length>0)for(var n=0;n<t.length;n++)if(t[n].url===e)return t[n];return!1}function p(e,n,r){var i={url:n,data:a.parseHtml(r)};e.list.push(i),e.list.length>e.limit&&(m("over cache limit of "+e.limit+", removing oldest data"),e.list=t.grep(e.list,function(t,e){return 0!==e}))}function y(e){b=t.grep(b,function(t){return t.url!==e})}function h(){w.on("StateManager.GotoUrl",function(t,e){d(e,{})})}var S,j=!0,m=j?e.debug:function(){},M=!1,v=null,x="traditional",w=t(window),q=t("body"),L={},C={list:[],limit:n.get("prefetchCacheLimit")},U={list:[],limit:n.get("ajaxCacheLimit")},b=[];return{init:r}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.Config,n.State,n.Loading,n.Ajax,n.Manager)}}(this,function(t,e,n,a,r,i){"use strict";function o(t){t=t||!1,e.init(t),n.init(),a.init(),i.init()}return o.prototype.Util=t,o.prototype.Config=e,o.prototype.State=n,o.prototype.Loading=a,o.prototype.Ajax=r,o.prototype.Manager=i,o});