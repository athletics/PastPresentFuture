/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/statemanager
 * @version 0.0.1
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Util",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t.jQuery))}(this,function(){"use strict";function t(t){return-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t}function e(t){document.title=n(t)}function n(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));return t}function r(){return!window.history&&window.history.pushState&&window.history.replaceState?"traditional":"dynamic"}var i,a=!0;return i=function(){return a&&"object"==typeof console&&console.log?Function.prototype.bind.call(console.log,console):void 0}(),{debug:i,fullyQualifyUrl:t,setDocumentTitle:e,getMode:r}}),function(t,e){"function"==typeof define&&define.amd?define("src/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(e){o=t.extend({content:".page_content_holder"},e)}function r(t,e){o[t]=e}function i(t){return t=t||!1,t?t in o?o[t]:null:o}var a=!0,o=(a?e.debug:function(){},{});return{init:n,set:r,get:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/State",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){"use strict";function n(){o.on("StateManager.AfterInitState",r)}function r(){var e=window.history.state,n=0;"undefined"!=typeof e.scrollTarget&&t(e.scrollTarget).length>0&&(n=t(e.scrollTarget).first().offset().top),t("html").hasClass("initial-load")?t("html").removeClass("initial-load"):t("html, body").stop().animate({scrollTop:n},200),o.trigger("OnDemandImages.Init"),o.trigger("WindowEvents.Scroll")}function i(t,n,r){"traditional"===e.getMode()?window.location=n:window.history.pushState(r,t,n)}var a=!0,o=(a?e.debug:function(){},t(window));return{init:n,pushState:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Loading",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t.jQuery,t.StateManager.Util))}(this,function(t,e){function n(){d.on(o+".Reveal",i).on(o+".Complete",a).on(o+".Progress",r)}function r(t,e){var n=0,r=e.event.target.getResponseHeader("X-Content-Length");"undefined"!=typeof r&&0!==r&&(n=e.event.loaded/r)}function i(){f.addClass("is-loading-ajax")}function a(){f.removeClass("is-loading-ajax"),l.css({overflow:"auto"})}var o="Loading",u=!0,d=(u?e.debug:function(){},t(window)),f=t("html"),l=t("body");return{init:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Ajax",["jquery","./Util","./Config","./State"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Config"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.State))}(this,function(t,e,n,r){"use strict";function i(e){if("undefined"==typeof e)return!1;if("undefined"==typeof e.url)return y(g+": loadAjax: ERROR: No url defined."),!1;m=e;var n=window.ProgressEvent&&window.FormData?!0:!1,r="undefined"!=typeof e.trackProgress?e.trackProgress:!1;S.url=e.url,n&&r&&(S.xhr=u),S.type="undefined"!=typeof e.type?e.type:"get",S.data="undefined"!=typeof e.data?e.data:{},"undefined"!=typeof e.dataType&&(S.dataType=e.dataType),S.timeout="undefined"!=typeof e.timeout?e.timeout:2e4,S.error=d,S.disableAfterSuccess="undefined"!=typeof e.disableAfterSuccess?e.disableAfterSuccess:!1,S.success=f,t.ajax(S)}function a(t){j.trigger("Loading.Progress",{event:t,type:"upload"})}function o(t){t.loaded>h&&(h=t.loaded),j.trigger("Loading.Progress",{event:t,type:"download"})}function u(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",a,!1),t.addEventListener("progress",o,!1),t}function d(t,e,n){y(g+": error loading: "+S.url),y(g+": error textStatus: "+e),y(g+": error errorThrown: "+n),"undefined"!=typeof m.error&&m.error(t,e,n)}function f(t){t.length<h&&(h=t.length),"undefined"!=typeof m.success&&m.success(t)}function l(e){var r=n.get("content");return e=t.parseHTML(e,document,!0),e=t(e),e.filter(r).add(e.find(r))}function s(e){var n=t.grep(e.find("a"),function(e){var n=t(e).attr("href")||"";return-1!==n.indexOf("mailto:")?!1:-1!==n.indexOf("localhost")?!0:-1!==n.indexOf(":")?!1:!0});return n}function c(n){var i=n,a=s(i);return t.each(a,function(){var n=t(this);n.on("click."+g,function(n){n.preventDefault();var i=t(this),a=e.fullyQualifyUrl(i.attr("href")),o=null,u=null;return 2==n.which||n.metaKey?!0:("undefined"!=typeof i.attr("title")&&(o=i.attr("title")),"undefined"!=typeof i.data("scroll-target")&&(u=i.data("scroll-target")),r.pushState(o,a,{scrollTarget:u,scrollPos:parseInt(t(document).scrollTop(),10),url:a}),j.trigger("StateManager.gotoUrl",a),void i.addClass("ajax-initialized"))}),n.addClass("ajax-initialized")}),i}var g="Ajax",p=!0,y=p?e.debug:function(){},h=0,S={},j=t(window),m=null;return{loadAjax:i,parseHtml:l,ajaxifyLinks:c}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("src/Manager",["jquery","./Util","./Ajax"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t.jQuery,t.StateManager.Util,t.StateManager.Ajax))}(this,function(t,e,n){"use strict";function r(){m||(h=t(".page_content_holder").first(),h.length<1||(i(),a({isInitLoad:!0}),y(),m=!0))}function i(){v=window.history,x=e.getMode(),"traditional"!==x&&(n.ajaxifyLinks(w),M.on("popstate",function(){f(v.state.url,{}),M.trigger("StateManager.StateChange")}))}function a(n){var r=!1,i=v.state,a=t("div.content").data("config"),u="";"undefined"!=typeof n&&"undefined"!=typeof n.isInitLoad&&(r=n.isInitLoad),"undefined"!=typeof a&&null!==a&&("undefined"!=typeof a.title&&(u=a.title),"undefined"!=typeof a.bodyClass&&w.addClass(a.bodyClass),e.setDocumentTitle(u),r||M.trigger("EventTrackAjax.RecordPageview",{url:i.url,title:u}),q=a,o(),M.trigger("StateManager.AfterInitState"))}function o(){if("dynamic"!==x)return!1;var n=v.state;t("a[data-prefetch]").each(function(r){if(r>U.limit)return!1;var i=e.fullyQualifyUrl(t(this).attr("href"));i!==n.url&&setTimeout(function(){s(i)},50*(r+1))})}function u(t){h.html(t.data),n.ajaxifyLinks(h),a()}function d(t){M.trigger(t?"Loading.Reveal":"Loading.Complete")}function f(t,e){"undefined"==typeof e&&(e={});var n=t,r=e,i=l({url:n,afterAjaxLoad:function(t){var e=L[L.length-1];p(n),g(b,n,t),e==n?f(n,r):j("******* still loading: "+e)}});return"undefined"!=typeof i.loading&&i.loading?(d(!0),!1):(d(!1),void u(i,e))}function l(t){var e,r=t.url,i=!0;return(e=c(b.list,t.url))?e:(e=c(U.list,t.url))?e:(e=c(L,t.url))?{loading:!0}:(t.isPrefetch&&(i=!1),L.push({url:r}),n.loadAjax({url:r,dataType:"html",trackProgress:i,success:t.afterAjaxLoad,error:function(){}}),{loading:!0})}function s(t){return"traditional"!==x?c(b.list,t)?!0:c(U.list,t)?!0:c(L,t)?!0:void l({url:t,isPrefetch:!0,afterAjaxLoad:function(e){p(t),g(U,t,e)}}):void 0}function c(t,e){if(t.length>0)for(var n=0;n<t.length;n++)if(t[n].url===e)return t[n];return!1}function g(e,r,i){var a={url:r,data:n.parseHtml(i)};e.list.push(a),e.list.length>e.limit&&(j("over cache limit of "+e.limit+", removing oldest data"),e.list=t.grep(e.list,function(t,e){return 0!==e}))}function p(e){L=t.grep(L,function(t){return t.url!==e})}function y(){M.on("StateManager.gotoUrl",function(t,e){f(e,{})})}var h,S=!0,j=S?e.debug:function(){},m=!1,v=null,x="traditional",M=t(window),w=t("body"),q={},U={list:[],limit:15},b={list:[],limit:15},L=[];return{init:r}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("src/Index",["./Util","./Config","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.Config,n.State,n.Loading,n.Ajax,n.Manager)}}(this,function(t,e,n,r,i,a){"use strict";function o(i){i=i||!1,t.init(),e.init(i),n.init(),r.init(),a.init()}return o.prototype.Util=t,o.prototype.Config=e,o.prototype.State=n,o.prototype.Loading=r,o.prototype.Ajax=i,o.prototype.Manager=a,o});