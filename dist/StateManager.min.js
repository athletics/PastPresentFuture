/*!
 * statemanager - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/StateManager
 * @version 0.1.0
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],function(n){return e(t,n)}):"object"==typeof exports?module.exports=e(t,require("jquery")):(t.StateManager=t.StateManager||{},t.StateManager.Util=e(t,t.jQuery))}(window,function(t){"use strict";function e(t){var e=!0;return e?t:(-1===t.indexOf("http://")&&-1===t.indexOf("http://localhost:8000/")&&"/"===t.substring(0,1)&&(t="http://localhost:8000/"+t),"http://localhost:8000/"===t&&"/"!==t.substring(t.length-1,t.length)&&(t+="/"),t)}function n(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var n in e)e.hasOwnProperty(n)&&(t=t.replace(new RegExp(n,"g"),e[n]));document.title=t}function a(){return t.history&&t.history.pushState&&t.history.replaceState?"dynamic":"traditional"}var r,r=function(){return"object"==typeof console&&console.log?console.log.bind(console):void 0}();return{debug:r,fullyQualifyUrl:e,setDocumentTitle:n,getMode:a}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Config=e(t.jQuery,t.StateManager.Util))}(window,function(t,e){function n(e){o=t.extend({content:".page_content_holder",ajaxContainer:".page_content_holder",prefetchCacheLimit:15,ajaxCacheLimit:15},e)}function a(t,e){o[t]=e}function r(t){return t=t||!1,t?t in o?o[t]:null:o}var i=!0,o=(i?e.debug:function(){},{});return{init:n,set:a,get:r}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/State",["jquery","./Util"],function(n,a){return e(t,n,a)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.State=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e,n){"use strict";function a(){l.on("StateManager:AfterInitState",r).on("StateManager:PushState",o)}function r(){var t=i();e("html").hasClass("initial-load")?e("html").removeClass("initial-load"):e("html, body").stop().animate({scrollTop:t},200)}function i(){var n=t.history.state||{};if(!1 in n)return 0;var a=e(n.scrollTarget);return a.length?a.first().offset().top:0}function o(a,r){r=e.extend({options:{url:r.url},title:""},r),"traditional"===n.getMode()?t.location=r.url:(t.history.pushState(r.options,r.title,r.url),l.trigger("StateManager:NewState"))}var u=!0,l=(u?n.debug:function(){},e(t));return{init:a,pushState:o}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],function(n,a){return e(t,n,a)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.StateManager=t.StateManager||{},t.StateManager.Loading=e(t,t.jQuery,t.StateManager.Util))}(window,function(t,e,n){function a(){l.on("StateManager:LoadingProgress",r).on("StateManager:LoadingReveal",i).on("StateManager:LoadingComplete",o)}function r(t,e){var n=0,a=e.event.target.getResponseHeader("X-Content-Length");a&&(n=e.event.loaded/a)}function i(){s.addClass("is-loading-ajax")}function o(){s.removeClass("is-loading-ajax")}var u=!0,l=(u?n.debug:function(){},e(t)),s=e("html");return{init:a}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config","./State"],function(n,a,r,i){return e(t,n,a,r,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./State")):(t.StateManager=t.StateManager||{},t.StateManager.Ajax=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.State))}(window,function(t,e,n,a){"use strict";function r(n){if(n=n||{},!(!1 in n)){var a=e.extend({data:{},dataType:"html",disableAfterSuccess:!1,timeout:2e4,trackProgress:!1,type:"get"},n);j=n;var r=t.ProgressEvent&&t.FormData;r&&a.trackProgress&&(a.xhr=u),a.error=i,a.success=o,a.beforeSend=function(t){t.requestUrl=a.url},e.ajax(a)}}function i(t,e,n){!1 in j||j.error(t,e,n)}function o(t,e,n){t.length<h&&(h=t.length),!1 in j||j.success(t,e,n)}function u(){var e=new t.XMLHttpRequest;return e.upload.addEventListener("progress",l,!1),e.addEventListener("progress",s,!1),e}function l(t){M.trigger("StateManager:LoadingProgress",{event:t,type:"upload"})}function s(t){t.loaded>h&&(h=t.loaded),M.trigger("StateManager:LoadingProgress",{event:t,type:"download"})}function f(t){t=e.parseHTML(t,document,!0);var n=a.get("content"),r=e(t);return r.filter(n).add(r.find(n))}function g(t){t=e.parseHTML(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],document,!0);var n=e(t),a=n.filter("title");return a.last().text()}function c(n){var a=e.grep(n.find("a"),function(n){var a=e(n),r=a.attr("href")||"";return"_blank"===a.attr("target")?!1:-1!==r.indexOf("mailto:")||-1!==r.indexOf("javascript:")?!1:-1!==r.indexOf("//")&&-1===r.indexOf(t.location.hostname)?!1:!0});return a}function d(t){var a=c(t);return e.each(a,function(){e(this).on("click."+p,function(t){if(2===t.which||t.metaKey)return!0;var a=e(this),r=n.fullyQualifyUrl(a.attr("href"));M.trigger("StateManager:GotoUrl",[r,{url:r,options:{scrollPos:parseInt(e(document).scrollTop(),10),scrollTarget:a.data("scroll-target"),url:r}}]),t.preventDefault()}).addClass("ajax-initialized")}),t}var p="Ajax",S=!0,h=(S?n.debug:function(){},0),M=e(t),j=null;return{loadAjax:r,parseHtml:f,parseTitle:g,ajaxifyLinks:d}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],function(n,a,r,i){return e(t,n,a,r,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.StateManager=t.StateManager||{},t.StateManager.Manager=e(t,t.jQuery,t.StateManager.Util,t.StateManager.Config,t.StateManager.Ajax))}(window,function(t,e,n,a,r){"use strict";function i(){q||(C=n.getMode(),b.limit=a.get("prefetchCacheLimit"),w.limit=a.get("ajaxCacheLimit"),s(),x.length&&(o(),u({isInitLoad:!0}),j(),q=!0))}function o(){"traditional"!==C&&(r.ajaxifyLinks(U),L.on("popstate",function(t){null!==t.originalEvent.state&&(c(y(),{popstate:!0}),L.trigger("StateManager:PopState"))}))}function u(t){t=t||{},t=e.extend({isInitLoad:!1,title:document.title},t),t.isInitLoad||(n.setDocumentTitle(t.title),s(),L.trigger("StateManager:RecordPageview",{url:y(),title:t.title})),l(),L.trigger("StateManager:AfterInitState")}function l(){"traditional"!==C&&e("a[data-prefetch]").each(function(t){var a=n.fullyQualifyUrl(e(this).attr("href"));a!==y()&&setTimeout(function(){p(a)},50*(t+1))})}function s(){x=e(a.get("content")).first(),m=e(a.get("ajaxContainer")).first(),a.get("content")!==a.get("ajaxContainer")&&L.trigger("StateManager:BeforeTransition",{contentHolder:x,ajaxContainer:m})}function f(t,e){e.prevBodyClasses=U.attr("class"),e.pageConfig=e.data.attr("data-page-config"),m.html(e.data.html()),r.ajaxifyLinks(m),U.removeClass().addClass(e.classes),a.get("content")!==a.get("ajaxContainer")?L.trigger("StateManager:AnimateTransition",e):u(e)}function g(t){L.trigger(t?"StateManager:LoadingReveal":"StateManager:LoadingComplete")}function c(t,n){n=n||{},n=e.extend({url:t,popstate:!1},n),L.off("StateManager:FetchedData").on("StateManager:FetchedData",function(a,r){r.url===t&&(n.popstate||L.trigger("StateManager:PushState",n),g(!1),L.trigger("StateManager:RenderUrl",r),e(this).off("StateManager:FetchedData"))});var a=d({url:t,afterAjaxLoad:function(t,e,n){t=h(w,n.requestUrl,t),L.trigger("StateManager:FetchedData",t)}});"loading"in a&&g(!0)}function d(t){var e=!0,n={};return(n=S(w.list,t.url))?L.trigger("StateManager:FetchedData",n):(n=S(b.list,t.url))?L.trigger("StateManager:FetchedData",n):(n=S(A,t.url))?{loading:!0}:(t.isPrefetch&&(e=!1),A.push({url:t.url}),r.loadAjax({url:t.url,dataType:"html",trackProgress:e,success:t.afterAjaxLoad,error:function(){location.reload(!0)}}),{loading:!0})}function p(t){"traditional"!==C&&d({url:t,isPrefetch:!0,afterAjaxLoad:function(e){M(t),e=h(b,t,e),L.trigger("StateManager:FetchedData",e)}})}function S(t,e){var n=!1;if(!t.length)return n;for(var a=0;a<t.length;a++)if(t[a].url===e){n=t[a];break}return n}function h(t,n,a){var i={url:n,title:r.parseTitle(a),data:r.parseHtml(a),classes:a.match(/body\sclass=['|"]([^'|"]*)['|"]/)[1]};return t.list.push(i),t.list.length>t.limit&&(t.list=e.grep(t.list,function(t,e){return 0!==e})),i}function M(t){A=e.grep(A,function(e){return e.url!==t})}function j(){L.on("StateManager:GotoUrl",function(t,e,n){c(e,n)}).on("StateManager:RenderUrl",f).on("StateManager:InitState",function(t,e){u(e)})}function y(){var e=t.history;return null!==e.state?e.state.url:t.location.href}var x,m,v=!0,q=(v?n.debug:function(){},!1),C=(t.history,"traditional"),L=e(t),U=e("body"),b={list:[],limit:null},w={list:[],limit:null},A=[];return{init:i}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./State","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./State"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var n=t.StateManager;t.StateManager=e(n.Util,n.Config,n.State,n.Loading,n.Ajax,n.Manager)}}(window,function(t,e,n,a,r,i){"use strict";function o(t){t=t||!1,e.init(t),n.init(),a.init(),i.init()}var u=o.prototype;return u.Util=t,u.Config=e,u.State=n,u.Loading=a,u.Ajax=r,u.Manager=i,o});